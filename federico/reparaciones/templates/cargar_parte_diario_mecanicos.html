<!DOCTYPE html>
{% load widget_tweaks %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cargar Parte Mecanico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/c11348c6ce.js" crossorigin="anonymous"></script>
</head>
<body class="bg-gray-50 font-sans leading-normal tracking-normal">
    <nav class="bg-black p-4 text-white flex justify-between items-center">
        <div class="flex items-center">
          <a href="{% url 'pablofederico' %}" class=" ml-4">
            <i class="fa-solid fa-house text-red-500"></i> Home
          </a>
          <a href="{% url 'logout' %}" class=" ml-4">
            <i class="fa-solid fa-power-off text-red-500"></i> Logout
          </a>
        </div>
    </nav>
    <div class="container mx-auto p-8">
        <div class="max-w-4xl mx-auto bg-white rounded-lg border border-gray-200 shadow-md p-5">
            <div class="justify-center flex">
                <h1 class="text-3xl font-bold mb-6">Partes Diarios Mecanicos</h1>
            </div>
            <form method="post" id="parte-form">
                {% csrf_token %}
                <p class="text-xl text-bold p-1">Mecanico: {{ mecanico }}</p>
                <p class="text-xl text-bold p-1">Fecha: {{ fecha }}</p>
                <div id="items-container" class="my-2">

                </div>
                <button type="button" id="add-item" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Agregar Actividad</button>
                <input type="submit" value="Guardar Parte" class="ml-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            </form>
            <script>
                var addedItems = []; // Lista para llevar un registro de los ítems añadidos

                document.getElementById('add-item').addEventListener('click', function() {
                    const container = document.getElementById('items-container');
                    const uniqueId = Date.now();

                    // Cambiamos selectHtml por inputHtml para permitir la entrada de texto
                    const inputHtml = `
                        <input type="text" name="textos[]" placeholder="Actividad Realizada" class="item-input form-input appearance-none block w-full px-4 py-2 text-base font-normal text-gray-700 bg-white bg-clip-padding bg-no-repeat border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" id="input-${uniqueId}">
                    `;

                    const itemHtml = `
                        <div class="item flex flex-col md:flex-row items-center md:space-x-3 py-2" id="item-${uniqueId}">
                            ${inputHtml}
                            <input type="number" name="cantidad[]" placeholder="Tiempo" min="1" class="quantity-input form-input appearance-none block w-auto px-4 py-2 text-base font-normal text-gray-700 bg-white bg-clip-padding bg-no-repeat border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none" id="quantity-${uniqueId}">

                            <button type="button" class="remove-item bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mt-2 md:mt-0" data-id="${uniqueId}">Eliminar</button>
                            <div class="error-message text-red-500 text-sm mt-2" id="error-${uniqueId}"></div>
                        </div>
                    `;

                    container.insertAdjacentHTML('beforeend', itemHtml);
                });

                document.getElementById('items-container').addEventListener('click', function(event) {
                    if (event.target.classList.contains('remove-item')) {
                        const itemId = event.target.getAttribute('data-id');
                        document.getElementById('item-' + itemId).remove();
                        updateAddedItemsList();
                    }
                });

                function updateAddedItemsList() {
                    addedItems = Array.from(document.querySelectorAll('.item-input'))
                                      .map(input => input.value)
                                      .filter(value => value !== "");
                }
                function validateBeforeAdd(itemCode) {
                    return !addedItems.includes(itemCode);
                }
            </script>
        </div>
    </div>
</body>
</html>
